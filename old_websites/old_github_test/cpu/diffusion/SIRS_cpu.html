<html><head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">
    <title>SIRS Field</title>
    <!-- get CSS -->
    <link rel="stylesheet" href="../../lib/wc.css" type="text/css">
    <!-- import the MathJax scripts -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
    </script>
    <script type="text/javascript"
      src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
    <!-- import fast convolution libraries -->
    <script type="text/javascript" src="../../lib/cpu/gaussian_convolution.js"></script> 
    <!-- import model parser library -->
    <script type="text/javascript" src="../../lib/model_parser.js"></script> 
    <!-- import color maps -->
    <script type="text/javascript" src="../../lib/colormaps.js"></script> 
    <!-- import fast crude random number generator -->
    <script type="text/javascript" src="../../lib/rng.js"></script> 
    <!-- the bulk of the code has been moved here. html files now only contain model configurations -->
    <script type="text/javascript" src="../../lib/spde.js"></script> 
</head>

<body onload="javascript:waitForMathJax()">

<!-- Loading message with spinner -->
<div class="overlay" id="hidingframe"><div class="outer">
<div class="middle">
<center>
The simulation is loading<br/>
This requires JavaScript and the MathJax servers.<br/><br/>
<img src="../../lib/loader.gif"/>
</center>
</div>
</div></div>

<!-- Ignore mouse clicks until the page is loaded -->
<div class="clickblocker" id="clickblock"></div>

<div class="outer" id="mainframe">
<div class="middle">
<div id='canvasdiv'>  

<!-- 
Define the user contolled parameters
-->
<div class="controlbox">
<!--
This tag automatically expanded/generated by the function
interpret_abbreviated_controls in the file model_parser.js
parameter shortand format is:
par NAME VALUE MIN MAX STEPSIZE
-->
<div class="controlgroup"> 
group reaction rates
par rp 0 0 100 0.01
par rii 0 0 100 0.01
par ri 0 0 100 0.01
par rr 0 0 100 0.01
par rs 0 0 100 0.01
group Nonlocal interactions
par Ss 1 1 10 1
par Si 1 1 10 1
par Sr 1 1 10 1
group Noise levels
par Ns 1 0 10 0.1
par Ni 1 0 10 0.1
par Nr 1 0 10 0.1
group Time constants
par Ts 10 0 100
par Ti 10 0 100
par Tr 10 0 100
group Diffusion rates
par Ds 1 0 100
par Di 1 0 100
par Dr 1 0 100
group Time stepping
par dt   0.1 0  10
par skip 3 1 50  1
</div>
<!--Create box for preset buttons-->
<div id="presets_container"><h4>Presets</h4><br/>
<div class="button_container" id="presets"></div></div></div>

<!--
Define drawing canvas and axis labels
-->     
<div style="position:relative;">
<canvas id='maincanvas'>
This application relies on the HTML5 Canvas element and Javascript. 
If you have Javascript disabled, try re-enabling it for this page.
</canvas>
<div class='axistitle' id='subplot1title'></div>
<div class='axislabel' id='subplot1xlabel'></div>
<div class='axislabel' id='subplot1ylabel'></div>
<div class='axistitle' id='subplot2title'></div>
<div class='axislabel' id='subplot2xlabel'></div>
<div class='axislabel' id='subplot2ylabel'></div>
<div class='axistitle' id='subplot3title'></div>
<div class='axislabel' id='subplot3xlabel'></div>
<div class='axislabel' id='subplot3ylabel'></div>
<div class='axistitle' id='subplot4title'></div>
<div class='axislabel' id='subplot4xlabel'></div>
<div class='axislabel' id='subplot4ylabel'></div>
<div id='canvasoverlay'><div class='vcenter'>Click to start</div></div>
</div>

<!--
Define right panel
Title, description, and control buttons
Button names are mapped to functions declared in the main loop
This tag automatically expanded/generated by the function
interpret_abbreviated_buttons in the file model_parser.js
-->     
<div class="infotext">
<h3>Neural Field Wave Demonstration</h3>
<span>TODO DESCRIPTION</span>
<br/>
<div class="controltext"></div>
<div class="button_container" id='buttongroups'>
group Simulation
button Start
button Step
button Save
button Load
group Initialization
button Randomize
button Perturb Homogeneous
button E Cell Impulse
button I Cell Impulse
button Stimulate
</div>
</div>

<!--TODO
    Move model description into it's own config string then
    Automatically generate the equation information below
-->
<div id="equation"></div>
</div>
</div>
</div>

<script type="text/javascript">

//Haven't got rid of hard-coded stimulation yet
//So remove amplitude parameter control and hard-code it to zero
amp = 0

// Beginning to make phase planes more configurable
// For now most of the options are not used
// Eventually information below will be incorporated into a 
// model description language


auxvars = [
    {name:'dSI',update:'S*(rp+Ki*ri)'},
    {name:'dIR',update:'I*(rr+I*rii)'},
    {name:'dRS',update:'R*rs'},
    {name:'Nsi',update:'RANDN*Ns*(1e-6+sqrt(dSI))'},
    {name:'Nir',update:'RANDN*Ni*(1e-6+sqrt(dIR))'},
    {name:'Nrs',update:'RANDN*Nr*(1e-6+sqrt(dRS))'},
    {name:'Npart',update:'(S+I+R)-1'},
    {name:'DSI',update:'max(0,dSI+Nsi)'},
    {name:'DIR',update:'max(0,dIR+Nir)'},
    {name:'DRS',update:'max(0,dRS+Nrs)'},
];

fields = [
    {name:'S',update:'((Ks-S)*Ds-DSI+DRS)/Ts-Npart'},
    {name:'I',update:'((Ki-I)*Di-DIR+DSI)/Ti-Npart'},
    {name:'R',update:'((Kr-R)*Dr-DRS+DIR)/Tr-Npart'}];
/*
fields = [
    {name:'S',update:'-S*(rp+Ki*ri)+Ks+ RANDN*Ns'},
    {name:'I',update:'-I+Ki+S*(rp+Ki*ri) + RANDN*Ni'},
    {name:'R',update:'-R+Kr'}];

fields = [
    {name:'S',update:'max(-S/dt,min((N-S)/dt,-(rp+Ki*ri)*Ks+Kr*rs + RANDN*Ns*(1e-6+sqrt(S))))'},
    {name:'I',update:'max(-I/dt,min((N-I)/dt, (rp+Ki*ri)*Ks-Kr*rr + RANDN*Ni*(1e-6+sqrt(I))))'},
    {name:'R',update:'max(-R/dt,min((N-R)/dt, Ki*rr-Kr*rs))'}];
*/

operators = [
    {name:'Ks',type:'GCONV',applyto:'S',params:{sigma:'Ss'}},
    {name:'Ki',type:'GCONV',applyto:'I',params:{sigma:'Si'}},
    {name:'Kr',type:'GCONV',applyto:'R',params:{sigma:'Sr'}},];

panel1 = {
    type:'field',
    title:'Rate<br/>Red=E, Green=I, Blue=|E-I|',
    R:'I',
    G:'R',
    B:'S',
}

panel2 = {
    type:'field',
    title:'Adaptation<br/>Red=E, Green=I, Blue=|E-I|',
    R:'R',
    G:'R',
    B:'R',
}

panel3 = {
    type:'phaseplane',
    title:'E/I trajectories in phase space<br/>Steady-state adaptation',
    ylabel:'I rate ∈[0,1]',
    xlabel:'E rate ∈[0,1]',
    xlim:[0,1],
    ylim:[0,1],
    x:'S',
    y:'I',
    dx:'-S*(rp+I*ri)+(1-S-I)*rs',
    dy:'(rp+I*ri)*S-(I*(rr+I*rii))',};

panel4 = {
    type:'phaseplane',
    title:'E/I trajectories in phase space<br/>Max adaptation',
    ylabel:'I rate ∈[0,1]',
    xlabel:'E rate ∈[0,1]',
    xlim:[0,1],
    ylim:[0,1],
    x:'I',
    y:'R',
    dx:'(rp+I*ri)*(1-I-R)-I*rr',
    dy:'(I*(rr+I*rii))-R*rs'};

presets=[
['0','randomize','rp=0;ri=2;rr=0.5;rs=0.5;Ss=1;Si=1;Sr=1;Ns=0;Ni=0;Nr=0.3;Ts=1;Ti=2;Tr=1;Ds=0;Di=1;Dr=0;dt=0.2;skip=1;'],
];

</script>

</body>
</html>



