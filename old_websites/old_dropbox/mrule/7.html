<html><!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link href="style.css" rel="stylesheet" type="text/css">
<title></title>
<link rel="icon" href="favicon.ico" type="image/x-icon"> 
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon"> 
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css">
body { 
    margin:0 auto;
    font-family: "Lucida Console", Monaco, monospace;
    color:black;
    line-height: 130%; 
    text-decoration:none; 
}
.dropshadow {
    width:827px;
    margin:0 auto;
    -moz-box-shadow:    0px 0px 14px #555;
	-webkit-box-shadow: 0px 0px 14px #555;
	box-shadow:         0px 0px 14px #555;
    position: absolute;
    top: 50%;
    left: 50%;
    width: 512;
    height: 512;
    margin-top: -256;
    margin-left: -256;
}
.pcursor {
    width: 11px;
    height:11px;
    margin: 0 0;
    background-color: #333;
    border: solid 1px #aaa;
	position: relative;
    /* rounded corners ( does not work in opera, IE ) */
    -moz-border-radius:    6px;
    -webkit-border-radius: 6px;
    -khtml-border-radius:  6px;
    border-radius:         6px;
}
.canvas {
	position: relative;
}
</style>
</head>
<body onload="demo()">
<div class="navboxen">
<div class="hiddenavbox"><a href="simple.html"> </a></div>
<div class="navbox"><a href="http://mathworld.wolfram.com/JuliaSet.html"> </a><div class="info">Julia Set</div></div>
<div class="navbox"><a href="https://bitbucket.org/mrule/julia/downloads"> </a><div class="info">Download</div></div>
<div class="navbox"><a href="http://wealoneonearth.blogspot.com/2011/07/instantly-boot-feedback-fractals-with.html"> </a><div class="info">More</div></div>
</div>


<div class="dropshadow">
<canvas id="canvas" width="1" height="1"">Sorry, your browser does not support JavaScript canvas, or it is disabled.</canvas>
<br clear="all" />
<br clear="all" />
<center>Hover to adjust Julia set point.</center>
<br clear="all" />
<center>Click within animation to pause or resume.</center>
</div>


<script type="application/javascript">

function print(msg) {
    setTimeout(function() {
        throw new Error(msg);
    }, 0);
}

function demo() 
{
	var N  = 512;
	var N2 = N/2;

	var canvas = document.getElementById('canvas');
	canvas.width  = N; 
	canvas.height = N; 
	var ctx = canvas.getContext('2d');
	var imageData = ctx.getImageData(0, 0, N, N);

	var map  = new Int32Array( N*N*2 );
	for (var y = 0; y < N; ++y) {
		for (var x = 0; x < N; ++x) {
			var real   = (x-N2)*4.0/N;
			var imag   = (y-N2)*4.0/N;
			var real2  = real*real-imag*imag;
			var imag2  = 2*real*imag;
			var x2     = Math.round((real2*N/4+N2)*16);
			var y2     = Math.round((imag2*N/4+N2)*16);
			var index  = y*N + x;
			map[index*2  ] = (x2 - N2*16);
			map[index*2+1] = (y2 - N2*16);
			//map[index*2  ] = xi+yi*N;
		}
	}
	var buff1 = new Uint8Array( N*N + 1);
	var buff2 = new Uint8Array( N*N + 1);

	offseti  = 0;
	offsetx  = 0;
	offsety  = 0;
	costheta = 0;
	sintheta = 0;
		
	noise_level = 200;
	blur_amount = 120;

	var buf  = new ArrayBuffer(imageData.data.length);
	var buf8 = new Uint8ClampedArray(buf);
	var data = new Uint32Array(buf);
	
	mouseback = function(e) {
		var mouseX, mouseY;
		var x = e.offsetX==undefined?e.layerX:e.offsetX;
		var y = e.offsetY==undefined?e.layerY:e.offsetY;
    	mouseX = x-canvas.offsetLeft-N2;
	    mouseY = y-canvas.offsetTop-N2;
		offsetx = mouseX*16 + N2*16;
		offsety = mouseY*16 + N2*16;
		
		mouseTheta  = Math.atan2(mouseX,mouseY);
		mouseRadius = 300;
		costheta    = Math.cos(mouseTheta)*mouseRadius;
		sintheta    = Math.sin(mouseTheta)*mouseRadius;
		
		/*console.log(e.offsetX,e.offsetY,canvas.offsetLeft,canvas.offsetTop,mouseX,mouseY,offsetx,offsety);*/
	};
	canvas.onmousemove = mouseback;
	canvas.onclick     = mouseback;
	canvas.onmouseup   = mouseback;
	
	var running = 1;
	
	function render() {
		var nmax = N*N-1;
		var nstop = nmax/2;
		nmax +=1 ;
		var writeindex = 0;
		var mapindex = 0;
		var bounds = (N/2)*(N/2);
		for (var y = 0; y < N; ++y) {
		for (var x = 0; x < N; ++x) {
			var x3 = map[mapindex  ]+offsetx;
			var y3 = map[mapindex+1]+offsety;
			var xi = x3>>4;
			var yi = y3>>4;
			var dx = xi-N/2;
			var dy = yi-N/2;
			if (dx*dx+dy*dy<bounds) {
				var xf = (x3&0xf);
				var yf = (y3&0xf);
				var xg = 16-xf;
				var yg = 16-yf;
				var index = xi+yi*N;
				var colorA = buff1[index    &0x3ffff]&0xff;
				var colorB = buff1[index  +1&0x3ffff]&0xff;
				var colorC = buff1[index+N  &0x3ffff]&0xff;
				var colorD = buff1[index+N+1&0x3ffff]&0xff;
				var colorE = (colorA*xg+colorB*xf);
				var colorF = (colorC*xg+colorD*xf);
				var color  = (colorE*yg+colorF*yf+8>>8);
				color = color*250>>8;
				color = color&0xff;
				color = color*0x010101;
				
			} else color=0xffffff;
			data[nmax-writeindex] = data[writeindex] = 0xff000000|color;
			buff2[nmax-writeindex] = buff2[writeindex] = color;
			mapindex += 2;
			writeindex ++;
			if (writeindex>nstop) break
			}
			if (writeindex>nstop) break
		}
		
		imageData.data.set(buf8);
		ctx.putImageData(imageData, 0, 0);
		
		var temp = buff2;
		buff2 = buff1;
		buff1 = temp;
		
		if (running) setTimeout(render, 0);
	}
	
	canvas.onclick = function(e) {
		running = 1-running;
		if (running) render();
	};
	
	render();
}

</script>
</body>
</html>


