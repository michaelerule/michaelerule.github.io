<html><head><meta content="text/html;charset=utf-8" http-equiv=Content-Type><meta content=utf-8 http-equiv=encoding><title>Flicker</title><style>body{margin:0;padding:0;font-family:Helvetica,Arial,Sans-Serif;background:#333;color:#fff;font-color:#fff}
A{text-decoration:none;color:#ff0;font-color:#ff0}
#maincanvas{margin:auto;padding:0;width:512px;height:512px;cursor:pointer;image-rendering:optimizeQuality}
#canvasoverlay{margin:auto;padding:0;width:511px;height:511px;cursor:pointer;background:#333;color:#fff;font-color:#fff;border:solid 1px #777;display:table;text-align:center}
#equation{width:auto;padding:10px;margin:auto;display:block;clear:both;text-align:center;font-size:75%}
#canvasdiv{padding:0;width:912px;height:auto;margin:auto auto;margin-top:25px}
.controlbox{width:200px;height:512px;float:left}
.controls{width:100px;float:right}
.infotext{float:right;margin-left:10px;width:190px;height:auto;font-size:80%}
.control{text-align:right;width:100%;font-size:97%}
.controltext{clear:both;display:block;padding-top:10px}
input[type=number]{margin:1px 10px;width:50px;font-size:85%;-webkit-appearance:none;background:#333;color:#fff;font-color:#fff;border:solid 1px #777;padding:1px 1px 1px 1px}
input::-webkit-inner-spin-button,input::-webkit-outer-spin-button{-webkit-appearance:none;margin:0;opacity:0;pointer-events:none}
input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}
input[type=number]{-moz-appearance:textfield}
.button_container{margin-top:4px;margin-left:1px;width:200px;font-size:80%}
.button{font-size:95%;text-decoration:none;float:left;margin:-1px -1px 0 0;border:solid 1px #777;width:auto;background:#333;color:#fff;font-color:#fff;border:solid 1px #777;padding:3px 7px 3px 7px}
.button:hover{background:#fff;text-decoration:none;color:#333;border:solid 1px #777}
.overlay{background:#333;color:#fff;font-color:#fff;position:fixed;width:100%;height:100%;top:0;left:0;z-index:1000}
.clickblocker{opacity:0;background:#333;color:#fff;font-color:#fff;position:fixed;width:100%;height:100%;top:0;left:0;z-index:1000}
#canvasoverlay,#equation,#maincanvas,.button,.button_container,.clickblocker,.control,.controlbox,.controls,.controltext,.overlay{-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default}
#canvasoverlay,#maincanvas,.button{cursor:pointer}
.outer{display:table;position:absolute;height:100%;width:100%}
.middle{display:table-cell;vertical-align:middle}
</style><script type=text/x-mathjax-config>MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
}
);</script><script type=text/javascript src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script>!function(e,i,t,a,n,r,o){e.GoogleAnalyticsObject=n,e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)}
,e[n].l=1*new Date,r=i.createElement(t),o=i.getElementsByTagName(t)[0],r.async=1,r.src=a,o.parentNode.insertBefore(r,o)}
(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-64211605-1","auto"),ga("send","pageview");</script><body onload=waitForMathJax()><div class=overlay style="margin:auto auto;height:100%;width:100%;font-size:80%" id=hidingframe><div class=outer><div class=middle><center>Please wait while the simulation loads<br>This page requires JavaScript and access to the MathJax servers.<br><br><img src="loader.gif"></center></div></div></div><div class=clickblocker style="margin:auto auto;height:100%;width:100%" id=clickblock></div><div class=outer id=mainframe><div class=middle><div id=canvasdiv><div class=controlbox style=font-size:85%;position:relative><div style=clear:both;display:block><div class=controls>Inhibitory<div class=control>$a_{ei}
$ <input type=number step=any max=100 min=0 name=Aei value="8.5"></div><div class=control>$a_{ii}
$ <input type=number step=any max=100 min=0 name=Aii value="3.0"></div><div class=control>$\tau_i$ <input type=number step=any max=100 min=0 name=Ti value="20.0"></div><div class=control>$\theta_i$<input type=number step=any max=100 min=-100 name=Hi value="3.5"></div><div class=control>$g_i$ <input type=number step=any max=100 min=-100 name=Gi value="0.0"></div><div class=control>$\sigma_i$<input type=number step=any max=100 min=0 name=Si value="1.5"></div></div><div class=controls>Excitatory<div class=control>$a_{ee}
$ <input type=number step=any max=100 min=0 name=Aee value="10.0"></div><div class=control>$a_{ie}
$ <input type=number step=any max=100 min=0 name=Aie value="12.0"></div><div class=control>$\tau_e$ <input type=number step=any max=100 min=0 name=Te value="10.0"></div><div class=control>$\theta_e$<input type=number step=any max=100 min=-100 name=He value="2.0"></div><div class=control>$g_e$ <input type=number step=any max=100 min=-100 name=Ge value="0.8"></div><div class=control>$\sigma_e$<input type=number step=any max=100 min=0 name=Se value="0.6"></div></div></div><br><div style=clear:both;display:block><div class=controls>Time stepping<div class=control>$\Delta t$<input type=number step=any max=100 min=0 name=dt value="2.0"></div><div class=control>Skip<input type=number step=1 max=50 min=1 name=display_every value="3"></div></div><div class=controls>Stimulus<div class=control>$A$ <input type=number step=any max=100 min=-100 name=Amp value="0.5"></div><div class=control>$T$ <input type=number step=any max=1000 min=0 name=T value="50.0"></div></div></div><div style=position:absolute;bottom:0;left:0><div class=controltext>Flicker Presets</div><div class=button_container><input class=button type=button value="Spots"> <input class=button type=button value="Stripe I"> <input class=button type=button value="Stripe II"></div><div class=controltext>Just for fun presets</div><div class=button_container><input class=button type=button value="Spirals"> <input class=button type=button value="Bumps"> <input class=button type=button value="Bubbles"> <input class=button type=button value="Stripes"> <input class=button type=button value="Oscillating stripes"> <input class=button type=button value="Oscillating spots"> <input class=button type=button value="Growing"> <input class=button type=button value="Cables"> <input class=button type=button value="Division"></div><div class=controltext style=width:240px>Simulation</div><div class=button_container><input class=button type=button value="Start"> <input class=button type=button value="Step"> <input class=button type=button value="Save"> <input class=button type=button value="Load"> <input class=button type=button value="Randomize"></div></div></div><div style=position:relative><canvas id=maincanvas style=position:absolute;left:200px;z-index:1>This application relies on the HTML5 Canvas element and Javascript. If you have Javascript disabled, try re-enabling it for this page.</canvas><div id=canvasoverlay style=position:absolute;left:200px;z-index:2><div style=display:table-cell;vertical-align:middle>Click to start</div></div></div><div class=infotext><h3 style=margin-top:0>Flicker Phosphene ModelThis is an implementation of the <a href="http://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1002158">flicker-phosphene hallucination model</a> in Javascript.<br><br>Three parameter settings that display flicker-induced pattern formation are available as presets. Some other parameters that lead to spontaneous (not flicker-induced) pattern formation are also available, just for fun.<br><br>This page uses <a href=http://www.mathjax.org>MathJax</a> to render $\LaTeX$ equations.<br><br>The E-cell firing rate is represented as yellow and the I-cell firing rate as blue.<br><br><span style=font-size:80%>Â©2015 Michael Rule all rights reserved</span></h3></div><div id=equation>\[S(t) = A \cdot \operatorname{Heav}
(\sin(2 \pi t / T) - 0.8)\] \[\tau_e \dot{U_e}
 = -U_e + f( a_{ee}
 \cdot K_e \star U_e - a_{ie}
 \cdot K_i \star U_i - \theta_e + g_e S(t) )\] \[\tau_i \dot{U_i}
 = -U_i + f( a_{ei}
 \cdot K_e \star U_e - a_{ii}
 \cdot K_i \star U_i - \theta_i + g_i S(t) )\] \[K_{e,i}
(x)=\frac{1}
{\sigma_{e,i}
 \sqrt{2\pi}
}
 \exp({{\mid x\mid^2}
 / 2\sigma_{e,i}
^2}
)\]</div></div></div></div><script type=text/javascript src=./gaussian_convolution.js></script><script type=text/javascript>function main(){function heav(e){return 0>e?0:0==e?.5:1}
function F(e){return 1/(1+Math.exp(-e))}
function Stim(e){var i=Math.sin(2*Math.PI*e/T);return heav(i-Str)*Amp}
function sim2image(){for(var e=0;H>e;++e)for(var t=0;W>t;++t)i=t+W*e,data[i]=4278190080|257*(255*Ue[i]&255)|65536*(255*Ui[i]&255)}
function showSim(){sim2image(),ctx.putImageData(imageData,0,0)}
function seedrand(){rand=Math.floor(16777216*Math.random())}
function weakrand(){return 152587890625e-16*(65535&(rand^=rand>>2^rand<<1))}
function randomize(){for(var e=0;H>e;++e)for(var i=0;W>i;++i){var t=i+W*e;Ue[t]=weakrand(),Ui[t]=weakrand()}
showSim()}
function setcontrols(){for(var i=0;i<controls.length;i++){var control=controls[i];eval("control.value="+control.name)}
}
function start(){running||(running=1,setTimeout(iterate,0)),stopstartbutton.value="Stop"}
function stop(){running&&(running=0),stopstartbutton.value="Start"}
function step(){stop(),iterate()}
function statestring(){for(var e="",i=0;i<controls.length;i++){var t=controls[i];e+=t.name+"="+t.value+";"}
return e}
function save(){var e=running;stop(),prompt("Copy (control+C) these parameters & record them.\nThey can be reloaded using the 'Load' button.\n",statestring()),e&&start()}
function loadstring(s){eval(s),setcontrols(),randomize(),start()}
function load(){stop(),result=prompt("Paste saved parameters below:\n",""),result&&loadstring(result)}
function spots(){loadstring("Aei=8.5;Aii=3;Ti=20;Hi=3.5;Gi=0;Si=2;Aee=10;Aie=12;Te=10;He=2;Ge=0.8;Se=0.8;dt=1;Amp=0.7;T=125;")}
function stripei(){loadstring("Aei=8.5;Aii=3;Ti=20;Hi=3.5;Gi=0;Si=2;Aee=10;Aie=12;Te=10;He=2;Ge=0.8;Se=0.8;dt=1;Amp=0.35;T=60;")}
function stripeii(){loadstring("Aei=8.5;Aii=3;Ti=20;Hi=3.5;Gi=0;Si=2;Aee=10;Aie=12;Te=10;He=2;Ge=0.8;Se=0.8;dt=1;Amp=1.5;T=50;")}
function spirals(){loadstring("Aei=8;Aii=5;Ti=12;Hi=2;Gi=0;Ni=0;Si=1;Aee=16;Aie=10;Te=1;He=4;Ge=0;Ne=0;Se=1;dt=1;Amp=0;T=125;")}
function bumps(){loadstring("Aei=8.5;Aii=3;Ti=30;Hi=3.5;Gi=0;Ni=0;Si=2.4;Aee=14;Aie=12;Te=10;He=3;Ge=0.8;Ne=0;Se=1;dt=1;Amp=0;T=60;")}
function stripes(){loadstring("Aei=8;Aii=5;Ti=16;Hi=4;Gi=0;Ni=0;Si=8;Aee=12;Aie=10;Te=1;He=2.5;Ge=0;Ne=0;Se=0.8;dt=1;Amp=0;T=125;")}
function oscillatingspots(){loadstring("Aei=40;Aii=16;Ti=6;Hi=3.5;Gi=0;Ni=0;Si=3;Aee=25;Aie=20;Te=1;He=2;Ge=0.8;Ne=0;Se=1;dt=.1;Amp=0;T=125;")}
function growing(){loadstring("Aei=8;Aii=5;Ti=16;Hi=2;Gi=0;Ni=0;Si=6;Aee=14.7;Aie=10;Te=1;He=3.8;Ge=0;Ne=0;Se=1.5;dt=1;Amp=0;T=125;")}
function bubbles(){loadstring("Aei=8.5;Aii=3;Ti=45;Hi=3.5;Gi=0;Ni=0;Si=2.4;Aee=14;Aie=12;Te=10;He=3;Ge=0.8;Ne=0;Se=1;dt=2;Amp=0;T=60;")}
function oscillatingstripes(){loadstring("Aei=8.5;Aii=3;Ti=45;Hi=3.5;Gi=0;Ni=0;Si=2.4;Aee=14.8;Aie=14;Te=10;He=3;Ge=0.8;Ne=0;Se=1;dt=2;Amp=0;T=60;")}
function division(){loadstring("Aei=8.5;Aii=3;Ti=50;Hi=3.5;Gi=0;Si=5;Aee=14;Aie=12;Te=10;He=3.2;Ge=0.8;Se=1.5;dt=7;Amp=0;T=60;")}
function cables(){loadstring("Aei=8.5;Aii=3;Ti=10;Hi=3.5;Gi=0;Si=5;Aee=14;Aie=12;Te=10;He=3.2;Ge=0.8;Se=1.5;dt=10;Amp=0;T=60;")}
function convolve(){blurGaussianFloat32Separable(Ue,Uec,temp,W,H,Se),blurGaussianFloat32Separable(Ui,Uic,temp,W,H,Si)}
function updateState(e){for(var i=0;H>i;++i)for(var t=0;W>t;++t){var n=t+W*i,a=Stim(e),r=F(Aee*Uec[n]-Aei*Uic[n]-He+Ge*a+(weakrand()-.5)*Ne),o=F(Aie*Uec[n]-Aii*Uic[n]-Hi+Gi*a+(weakrand()-.5)*Ni);Ue[n]+=(r-Ue[n])/Te*dt,Ui[n]+=(o-Ui[n])/Ti*dt}
}
function iterate(){running&&requestAnimationFrame(iterate);for(var i=0;i<controls.length;i++){var control=controls[i];eval(control.name+"="+control.value)}
for(var i=0;display_every>i;i++)seedrand(),convolve(),updateState(timestep*dt),timestep+=1;showSim()}
var canvas=document.getElementById("maincanvas"),frame=document.getElementById("canvasdiv"),downscale=1,W=canvas.clientWidth>>downscale,H=canvas.clientHeight>>downscale;canvas.width=W,canvas.height=H;for(var ctx=canvas.getContext("2d"),imageData=ctx.getImageData(0,0,W,H),data=new Uint32Array(imageData.data.buffer),y=0;H>y;y++)for(var x=0;W>x;++x)data[x+W*y]=4278190080|16777215*(1&(x^y));ctx.putImageData(imageData,0,0);for(var dt=1,Te=10,Ti=20,Se=.8,Si=2.5*Se,Aee=10,Aie=12,Aei=8.5,Aii=3,He=2,Hi=3.5,Ne=0,Ni=0,T=125,Ge=.8,Amp=.7,Gi=0,Str=.8,display_every=3,running=0,Ue=new Float32Array(new ArrayBuffer(W*H*4)),Ui=new Float32Array(new ArrayBuffer(W*H*4)),Uec=new Float32Array(new ArrayBuffer(W*H*4)),Uic=new Float32Array(new ArrayBuffer(W*H*4)),temp=new Float32Array(new ArrayBuffer(W*H*4)),y=0;H>y;++y)for(var x=0;W>x;++x)i=x+W*y,Ue[i]=1&(x^y),Ui[i]=1-Ue[i];showSim();var rand=Math.floor(16777216*Math.random());randomize(),blurGaussianFloat32Separable(Ue,Ue,temp,W,H,Se),blurGaussianFloat32Separable(Ui,Ui,temp,W,H,Si),showSim();for(var inputs=document.getElementsByTagName("input"),controls=[],i=0;i<inputs.length;i++)"number"==inputs[i].type&&controls.push(inputs[i]);setcontrols();for(var buttons=[],stopstartbutton,i=0;i<inputs.length;i++){var button=inputs[i];"button"==button.type&&(buttons.push(button),button.onclick=function(button){return function(click){eval(button.value.replace(/\s/g,"").toLowerCase()+"()")}
}
(button),"Start"==button.value&&(stopstartbutton=button,button.style.width=button.offsetWidth))}
!function(){for(var e=0,i=["webkit","moz"],t=0;t<i.length&&!window.requestAnimationFrame;++t)window.requestAnimationFrame=window[i[t]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[i[t]+"CancelAnimationFrame"]||window[i[t]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(i,t){var n=(new Date).getTime(),a=Math.max(0,16-(n-e)),r=window.setTimeout(function(){i(n+a)}
,a);return e=n+a,r}
),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)}
)}
();var timestep=0,frametime=+new Date,framedelayms=25,nextframe=frametime+framedelayms,frameskip=1;canvas.onmousedown=function(e){running?stop():start()}
;var hidingframe=document.getElementById("hidingframe"),canvasoverlay=document.getElementById("canvasoverlay"),clickblock=document.getElementById("clickblock");hidingframe.style.display="none",clickblock.style.cursor="pointer",clickblock.onclick=function(e){canvasoverlay.style.display="none",clickblock.style.display="none",start()}
}
function waitForMathJax(){MathJax.Hub.Queue(["Typeset",MathJax.Hub]),MathJax.Hub.Queue(main)}
</script>
