<html><head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">
    <title>Neural Field</title>
    <!-- get CSS -->
    <link rel="stylesheet" href="../../lib/wc.css" type="text/css">
    <!-- import the MathJax scripts -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
    </script>
    <script type="text/javascript"
      src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
    <!-- import fast convolution libraries -->
    <script type="text/javascript" src="../../lib/cpu/gaussian_convolution.js"></script> 
    <!-- import model parser library -->
    <script type="text/javascript" src="../../lib/model_parser.js"></script> 
    <!-- import color maps -->
    <script type="text/javascript" src="../../lib/colormaps.js"></script> 
    <!-- import fast crude random number generator -->
    <script type="text/javascript" src="../../lib/rng.js"></script> 
    <!-- the bulk of the code has been moved here. html files now only contain model configurations -->
    <script type="text/javascript" src="../../lib/spde.js"></script> 
</head>

<body onload="javascript:waitForMathJax()">

<!-- Loading message with spinner -->
<div class="overlay" id="hidingframe"><div class="outer">
<div class="middle">
<center>
The simulation is loading<br/>
This requires JavaScript and the MathJax servers.<br/><br/>
<img src="../../lib/loader.gif"/>
</center>
</div>
</div></div>

<!-- Ignore mouse clicks until the page is loaded -->
<div class="clickblocker" id="clickblock"></div>

<div class="outer" id="mainframe">
<div class="middle">
<div id='canvasdiv'>  

<!-- 
Define the user contolled parameters
-->
<div class="controlbox">
<!--
This tag automatically expanded/generated by the function
interpret_abbreviated_controls in the file model_parser.js
parameter shortand format is
par NAME VALUE MIN MAX STEPSIZE
-->
<div class="controlgroup"> 
group Parameters
par v 1
par Delta 1
par kappa 1
par alpha 1
par beta 0
par q 0.1
par eta 1
par C 1
par D 0.01
par N 1
group Time stepping
par dt  .01 0 10
par skip 1 1 50 1
</div>
<!--Create box for preset buttons-->
<div id="presets_container"><h4>Presets</h4><br/>
<div class="button_container" id="presets"></div></div></div>

<!--
Define drawing canvas and axis labels
-->     
<div style="position:relative;">
<canvas id='maincanvas'>
This application relies on the HTML5 Canvas element and Javascript. 
If you have Javascript disabled, try re-enabling it for this page.
</canvas>
<div class='axistitle' id='subplot1title'></div>
<div class='axislabel' id='subplot1xlabel'></div>
<div class='axislabel' id='subplot1ylabel'></div>
<div class='axistitle' id='subplot2title'></div>
<div class='axislabel' id='subplot2xlabel'></div>
<div class='axislabel' id='subplot2ylabel'></div>
<div class='axistitle' id='subplot3title'></div>
<div class='axislabel' id='subplot3xlabel'></div>
<div class='axislabel' id='subplot3ylabel'></div>
<div class='axistitle' id='subplot4title'></div>
<div class='axislabel' id='subplot4xlabel'></div>
<div class='axislabel' id='subplot4ylabel'></div>
<div id='canvasoverlay'><div class='vcenter'>Click to start</div></div>
</div>

<!--
Define right panel
Title, description, and control buttons
Button names are mapped to functions declared in the main loop
This tag automatically expanded/generated by the function
interpret_abbreviated_buttons in the file model_parser.js
-->     
<div class="infotext">
<h3>Neural Field Wave Demonstration</h3>
<span>TODO DESCRIPTION</span>
<br/>
<div class="controltext"></div>
<div class="button_container" id='buttongroups'>
group Simulation
button Start
button Step
button Save
button Load
group Initialization
button Phase Randomize
button Randomize
button Perturb Homogeneous
button E Cell Impulse
button I Cell Impulse
</div>
</div>

<!--TODO
    Move model description into it's own config string then
    Automatically generate the equation information below
-->
<div id="equation"></div>
</div>
</div>
</div>

<script type="text/javascript">

//Haven't got rid of hard-coded stimulation yet
//So remove amplitude parameter control and hard-code it to zero
amp = 0

// Beginning to make phase planes more configurable
// For now most of the options are not used
// Eventually information below will be incorporated into a 
// model description language


/*

Derivation

b  = eta + v*g

2C dZ/dt = -i(Z-1)^2 + (Z+1)^2*(-D+i*b)-(Z^2-1)*g

Z = x+iy

-i(x+iy-1)^2 + (x+iy+1)^2*(-D+i*b)-((x+iy)^2-1)*g

Expanded real part
-2bxy-2by-Dx^2-2Dx+Dy^2-D-gx^2+gy^2+g+2xy-2y

Expanded imaginary part
bx^2+2bx-by^2+b-2Dxy-2Dy-2gxy-x^2+2x+y^2-1

Is there some way to compute exactly the second derivative?
The next location after the update is:

Z + [-i(Z-1)^2 + (Z+1)^2*(-D+i*b)-(Z^2-1)*g]*dt/2C

We want to know the change in the derivative across this update


Z' = Z+[-i(Z-1)^2 + (Z+1)^2*(-D+i*b)-(Z^2-1)*g]*dt/2C

dZ /dt = [-i(Z -1)^2 + (Z +1)^2*(-D+i*b)-(Z ^2-1)*g]/2C
dZ'/dt = [-i(Z'-1)^2 + (Z'+1)^2*(-D+i*b)-(Z'^2-1)*g]/2C

d^2Z/dt^2 = [dZ'/dt - dZ /dt]/dt

Can we brute force it?

[-i(Z'-1)^2 + (Z'+1)^2*(-D+i*b)-(Z'^2-1)*g]-[-i(Z -1)^2 + (Z +1)^2*(-D+i*b)-(Z ^2-1)*g]

Z' = (Z+[-i(Z-1)^2 + (Z+1)^2*(-D+i*b)-(Z^2-1)*g]*dt/2C)
   = (Z+dz)

[-i((Z+[-i(Z-1)^2 + (Z+1)^2*(-D+i*b)-(Z^2-1)*g]*dt/2C)-1)^2 + ((Z+[-i(Z-1)^2 + (Z+1)^2*(-D+i*b)-(Z^2-1)*g]*dt/2C)+1)^2*(-D+i*b)-(((Z+[-i(Z-1)^2 + (Z+1)^2*(-D+i*b)-(Z^2-1)*g]*dt/2C))^2-1)*g]-[-i(Z -1)^2 + (Z +1)^2*(-D+i*b)-(Z ^2-1)*g]

This is still too large for wolfram alpha to simplify

[Z+dz-dz/dt]/dt

[Z*dt+dz*dt-dz]/dt^2

Well that did not work. 



*/

auxvars=[
    {name:'b',update:'v*g + eta'},
    {name:'h',update:'(1-x*x-y*y)/(1+2*x+x*x+y*y)'}];

operators = [
    {name:'Dx',type:'LAPL',applyto:'x',params:{}},
    {name:'Dy',type:'LAPL',applyto:'y',params:{}}];

fields = [
    {name:'x',
        update:'D*Dx+(-Delta*(x+y+1)*(x+1-y)-2*y*(b*(x+1)+1-x)+g*((y+x)*(y-x)+1))/(2*C*(T*q+1))+RANDN*N',
    },
    {name:'y',
        update:'(b*(x+y+1)*(x+1-y)-2*y*(Delta*(x+1)+g*x)+(y+x-1)*(y-x+1))/(2*C*(T*q+1))+RANDN*N',
    },
    {name:'T',update:'beta*(RANDN*N-T)'},
    {name:'g',update:'alpha*(g2-g)'},
    {name:'g2',update:'alpha*(kappa*h-g2)'}];

panel1 = {
    type:'field',
    title:'Rate<br/>Red=x, Green=y, Blue=|x-y|',
    R:'(x+1)/2',
    G:'(y+1)/2',
    B:'abs(x-y)/2',
}

panel2 = {
    type:'field',
    title:'Adaptation (R)',
    R:'f(g)',
    G:'f(g2)',
    B:'f(T)',
}

panel3 = {
    type:'phaseplane',
    title:'Rectangular nullclines',
    ylabel:'y',
    xlabel:'x',
    xlim:[-1,1],
    ylim:[-1,1],
    x:'x',
    y:'y',
    dx:'-Delta * (x+y+1) * (x+1-y) - 2 * y * ( (eta +  v * kappa*(1-x*x-y*y)/(1+2*x+x*x+y*y)) * (x+1)+1-x) + kappa*(1-x*x-y*y)/(1+2*x+x*x+y*y) * ((y+x) * (y-x)+1) ',
    dy:'(eta +  v * kappa*(1-x*x-y*y)/(1+2*x+x*x+y*y)) * (x+y+1)* (x+1-y)  - 2 * y *( Delta * (x+1)+kappa*(1-x*x-y*y)/(1+2*x+x*x+y*y)*x) +  (y+x-1)*(y-x+1)',};

panel4 = {
    type:'phaseplane',
    title:'Polar nullclines',
    ylabel:'y',
    xlabel:'x',
    xlim:[-1,1],
    ylim:[-1,1],
    x:'x',
    y:'y',
//    dx:'-Delta*((x+2)*y*y + x*(x+1)*(x+1)) - (x*x+y*y-1)*(( (eta +  v * (1-x*x-y*y)/(1+2*x+x*x+y*y))-1)*y+kappa*(1-(x*x+y*y))/(1+2*x+x*x+y*y)*x)',
//    dy:'x*((eta +  v * (1-x*x-y*y)/(1+2*x+x*x+y*y))-1)*(x*x+y*y+1)-(-Delta+kappa*(1-x*x-y*y)/(1+2*x+x*x+y*y))*y+(x*x+y*y)*(2*((eta +  v * (1-x*x-y*y)/(1+2*x+x*x+y*y))+1)+(-Delta-kappa*(1-x*x-y*y)/(1+2*x+x*x+y*y))*y)',
    dx:'(1-x*x-y*y)*(y*(eta+v*kappa*(1-x*x-y*y)/(1+2*x+x*x+y*y)-1)+x*kappa*(1-x*x-y*y)/(1+2*x+x*x+y*y))-(1+x*x+y*y)*x*Delta - 2*(x*x+y*y)*Delta',
    dy:'(1+x*x+y*y)*(x*(eta+v*kappa*(1-x*x-y*y)/(1+2*x+x*x+y*y)-1)-y*kappa*(1-x*x-y*y)/(1+2*x+x*x+y*y))+(1-x*x-y*y)*y*Delta + 2*(x*x+y*y)*(1+eta+v*kappa*(1-x*x-y*y)/(1+2*x+x*x+y*y))',
};

presets=[
];


</script>

</body>
</html>




